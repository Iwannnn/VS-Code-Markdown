##### 1.TEC-2机的技术指标
- EC-2机的字长为16位，即运算器、主存、数据与地址总线均为16位;
- TEC-2机的指令系统，基本指令系统支持类PC机的64条指令，其中53条指令已实现，尚留11条指令供实验者自己实现;
- 主存支持64K字，通常用字寻址方式，现安装了4kW的ROM，存放监控程序，2kW的RAM，存放用户程序及数据;
- 运算器由4片4位的Am2901器件级联而成，一片Am2902实现高速进位;
- 控制器采用微程序方案实现，控存字长56位，可用最大容量1024个字，
- TEC-2机主机上有两个串行接口，能直接与计算机终端或PC机（作为仿真终端）相连，在监控程序控制下完成TEC-2机操作;
- 作为TEC-2机的扩展部分，TEC-2机通过一条50芯扁平电缆，可以与一块由通用面包板组成的扩展实验板相连。在实验板上用户可以完成主存扩展、并行接口、实时钟、DMA接口、A/D或D/A转换接口等实验，能驱动打印机、软磁盘驱动器等外设的工作;此时TEC-2机支持7级中断;
- TEC-2机主振通常用1.8432MH（串行口所用的晶振频率）的分频脉冲给出，用户也可外接主振信号;
- TEC-2机上安装有约26个钮子开关、3个按钮微动开关、16个发光二级管等，在不接入计算机终端与PC机的情况下，能在手动方式下完成全部的实验项目
2. TEC-2机的指令系统
（1）无操作数 无操作数指令共11条。其格式如下:
```
NOP    ; 空操作
PSHF   ; 状态字入栈
POPF   ; 状态字出栈
EI     ; 开中断，INTE＝1
DI     ; 关中断，INTE＝0
STC    ; 进位置1
CLC    ; 进位清0
RET    ; 子程序返回
IRET   ; 中断返回
LDMC   ; 装入微指令代码
HALT   ; 动态停机指令
```
（2）单操作数指令共12条。
```
PUSH    DR    ; 压入DR
POP	    DR    ; 弹出DR
INC	    DR    ; DR←DR+1	
DEC     DR    ; DR← DR-1
NOT     DR    ; DR求反，DR←/DR
SHL     DR    ; DR左移，最低位补0，最高位移入C。
ASR     DR    ; DR算术右移，最高位不变，最低位移入C。
SHR     DR    ; DR逻辑右移，最高位补0，最低位移入C。
RCL     DR    ; DR与C循环左移，C入最低位，最高位移入C。
RCR     DR    ; DR与C循环右移，C入最高位，最低位移入C。
MUL     SR    ; 无符号乘，R1×SR→R0R1，根据R1的值置状态位
DIV 	SR    ; 无符号除，R0R1/SR→R0（余数）R1（商），根据R1的值置状态位
```

（3）双操作数指令共17条。
```
ADD	DR，SR        ;DR←DR+SR
ADC	DR，SR        ;DR←DR+SR+C
SUB	DR，SR        ;DR←DR－SR
SBB	DR，SR        ;DR←DR－SR－C
CMP	DR，SR        ;DR－SR
AND	DR，SR        ;DR←DR and SR
OR	DR，SR        ;DR←DR or SR
XOR	DR，SR        ;DR←DR xor SR
TEST DR，SR       ;DR&SR
MOV	DR，SR        ;DR←SR
MOV	DR，[SR]      ;DR←[SR]
MOV	[DR]，SR      ;[DR]←SR
MOV DR，DATA      ;DR←DATA
MOV	DR，[ADR]     ;DR←[ADR]
MOV	[ADR]，SR     ;[ADR]←SR
MOV	DR，DATA[SR]  ;DR←[DATA+SR]
MOV	DATA[SR]，DR  ;[DATA+SR]←DR
```

（4）I/O指令
```
IN    PORT    ;R0←[PORT]，从外设读入一字节到R0低8位
OUT   PORT    ;[PORT]←R0，把R0的低8位数据写到外设
```
（5）转移指令

- 相对转移指令:
```
JR	ADR      ;无条件相对转移到ADR，ADR为原PC值+位移量
JR	CND,ADR  ;条件满足时相对转移到ADR，ADR为原PC值+位移量
```

- 通过通用寄存器给出转移地址的转移指令。
```
JP  SR       ;无条件转SR所指的地址
JP  CND，SR  ;当条件满足时转SR所指的地址
```

- 按绝对地址实现的转移指令
```
JP  ADR         ;无条件转移到ADR地址；
JP  CND，ADR    ;当条件满足时转移到ADR。
```
（6）子程序调用指令
```
CALL  SR    ;调用SR指明的子程序，即SP←SP-1、[SP]←PC、PC←SR。
CALL  ADR   ;调用通过ADR指明的子程序，即SP←SP-1、[SP]← PC、PC←ADR。
```

##### 监控命令

（1）用监控命令A输入汇编程序

```>A```或```>A```主存地址

如：```>A800↙```

逐条打入所需的汇编语句，系统会逐句进行汇编，并将执行代码连续存放在给定地址当中。

若发现错误语句，系统将提示错误位置，并要求重新打入正确的语句。

直接按回车退出汇编模式。

如：
```
>A800↙

0800：MOV R1，100

0802：MOV R2，R1

0803：ADD R2，R1

0804：RET
```
本机内存设有2KW的RAM存储区供用户使用，起始地址从0800H开始。要注意，输入的程序或数据在断电的情况下会丢失。


（2）用监控命令U调出输入过的程序并显示在屏幕上
```>U ```或```>U```主存地址
如：
```
>U800↙
0800：2C10 0100 MOV R1，0100
0802：2021 MOV R2，R1
0803：0421 ADD R2，R1
0804：AC00 RET
```
通过这一步进一步检查程序是否有除了语法外的其它错误。

用U命令显示已输入的程序时，最左边的一列是地址，中间的一列是机器指令，最右边的一列是汇编语言指令。


（3）通过监控命令G（连续执行）或T/P（单步执行）执行程序
```>G/T/P``` 或```>G/T/P```主存地址
如：>G800↙
⑷修改或显示寄存器或内存值的命令。R、D、E命令的使用
如显示R2的值
```>RR2↙```
显示：0200:-
?如显示R1的值并修改
```>RR1↙```
显示：0100:-0300
0100为R1当前值，“-”后可输入要修改的新的16位二进制数0300。
如显示所有寄存器的值
```>RR↙```
显示上述程序所在内存
```>D800↙```
显示：
```
0800 2C10 0100 2021 0421 AC00 FFFF 0004 FFFB , · · · ! · ! ，· · · · · · {
0808 ┉
```
系统每一行显示8个单元，最左列为8个单元的首地址，中间为连续8个单元存放的内容，由空格隔开，右边的列为各个单元的ASCII码。在本例中，前5个单元为程序段的机器码，后3个单元为随机数。

显示并修改内存（本例中修改程序第一条指令中的立即数）

```>E800↙```

显示：```0800 2C10:```

之后按空格

显示：```0800 2C10: 0100:```

之后输入：```3333空格```

显示：````0800 2C10: 0100: 3333 2021:````

0800后的2C10是地址为0800H单元的当前值，“:”后可输入要修改的新值，不修改可按回车退出或按空格找下一单元。

（4）注意事项：
程序中，所有数字都使用16进制数。数字后不跟字符H。

每个程序的最后一条语句必须为RET语句。

程序中用到的监控程序的部分子程序调用，可查阅§1.2 TEC-2机的指令系统与汇编语言程序设计中的表1.2.2。

程序1:
```
>A880↙
0880： MOV R8，1234
MOV R9，9678
MOV R10，6789
MOV R11，8888
ADD R9，R11
ADC R8，R10
RET
```





1·TEC-2机控制器部件的组成
TEC-2相启〕控制器的简化逻辑框图在功能部件框图的左部，详细逻辑图在附录14逻辑线路图（二）上。TEC-2机控制器部件的关键内容包括：

（1）臼7片LS6116随机写存储器芯片组成的56位字长的程序控制存储器，用于存放TEC．2机的微程序。其内容在刚加电时不定孬加电后将首先从2片ROM（Ls2716芯片）中读出固化的、用于实现53条机器指令的微程序，经组织后写入这一控制存储器，这一过程称为装入微码。装入完成后，将从监控程序的零地址执行指令，完成TEC-2相启动过程。这之后，还可以用LDMC指令按规定的办法向控制存储器写入新的微程序，以实现新的机器指令。从简化逻辑框图上可以看到，控制存储器的地址为uRA9斗RAO，读出的信皂送微指令流水线寄存器PLR。

（2）微指令寄存器PLR臼7片8位的寄存器芯片（6片Ls374和1片LS273）成，用于存放当前微指令的内容，更具体的说明将在后面给出。

（3）微程序定序器AM2910芯片（其内部结构、引脚信号和运行原理等稍候详细说明），是微程序控制器中菲常关键、也是稍微進懂一点的部分。在字习中要正确理解。它的核心功能是侬据机器的运行状态与当前微指令的有关内容等正确地形成下一条微指令的地址

（5）指令寄存器IR，用于存放当前正在执行的指令内容。

（6）为AM2910提供输入地蚶信号的配套线路，包括由两片Ls2716ROM芯片组成的MAPROM，它将指令寄存器中的操作码转换成一段微程序的入囗地址；
①由2片LS125和1片LS244组成的接收内部线的旧9、旧0信号的选择门电路，它吧出水平板上的开关提供的微指令地址送AM2910的地址输入端
②由1片LS125和微指令寄存器的PLR55、48组成的一组地址输入，吧当前微指令中的后续地址B55、46送入AM2910的地址输入端；请注意1片Ls125（共4位独立的输入和输出端）分成两组（每组两位）分别用于0和．两顶用途。
这三组信号均为10位宽且为互斥关系分别由AM2910芯片提供的3个互斥控制信号/MAP、/VECT和/PL加以选通。

（7）由AM2910芯片的10位地址输出信号驱动的配套电路，包括·
①出一片LS175和一片LS374寄存器组构成的记忆电路，用于保存当前微指令的t上，其输出仅送往显示灯部分，以显示当前微指令的地址．

②由3片Ls257（四位的二选一电路）芯片构成的微控存的地址选择形成电路，它实现在AM2910的10位输出地址与存储器地址寄存器的低10位地址之间的选择结果送往微控存的地址输入端，用于完成微控存单元的读写臊作；选择信号是Smux。

③与此有关的还有3片计数器芯片LSI61组成的地址计数器电路，其输出（共10位）通过两片LS244与刚提到的3片Ls257的10位输出形成“线或”关系，用计数器的一个输出端Y11实现二者之间的选择Y11为0时，pRA9、wRA0是计数器的输出信号提供完成装入微码过程的微控存的地址，Y11为1时，表明装入微码的过程已结束微控存的地址RA9、pRA0为3片LS257的输出信号，以完成机器指令运行过程中的微控存的读写（写仅用于LDMC指令）操作。

2.关于微码装入问题
前边已简单地提到过TEC．2机微码装入问题。TEC．2机支時64条基不机器指令，已实现了53条指令。相应这53条机器指令的微程序保存在2片LS2716ROM芯片中，这2片LS2716ROM组成了一个亏用的2K容量的16位固定存储器。它每4个相邻的字用于存放一条56位字长的微指今，其中第4个字的最高8位耒用·用零嶙充。为了吧每一条微指令装入微控存，就必须分4次侬次读出4个16位的字，并分别送到56位字长的LDR審存器的不同的16位（最高位部分貝有8位）部分，然后一次写入56位的微控存中。为此，设立了两个地址计数器。第一个计数器由3片4位的计数器LS161芯片组成，加电时使其被清零，以后每来一个特定的工作脉冲计数一次。它的输出一方面用作微控存写少、单元的地址，又用作读ROM芯片的高9位地址。读ROM芯片的嚴低两位地址则由第2个计数器提供，这是个用一片计数器电路LS161芯片接成4分频的计数器，每计满4次则给出一个脉冲输出信号，用作为第一个计数器的特定计数脉冲，保证第二个计数器每计满4次。第一个计数器才计数一次，两个计数器的输出拼接成11位的地址，用于读ROM的字地址。第2个计数器的4次计数的不同状态，还用于控制吧从ROM中读出的内容写入LDR寄存器的不同部分，图上用LRCPO、LRCPI、LRCP2和LRCP3*示。当读完ROM的所有单元（共2048个字），计数器的YI1将从0变为1。则结束微码装入操作。里清注意微控存的地址是通过3选1逻辑给出的，即靠Smux实现对AM2910的10位蝓出和存储器的地址寄存器的低10位输出的2选|，靠YI1和11实现的对2远1的10位输出与计数器的10位输出经两片LS244的“线或。选择。逻辑图上可以看得清楚，两片LS244的输出和3片2选《的输出都标明为pRA9、#RAO，实现中它们的相应僅是接在一起的。LDMC/RESET按钮都后动微程序代码的装入作过程，详细线路爹见逻辑线路图（二）右下角部分的内容。

3.微指令格式
每条微指令由位组成，从高向低各位标记为B55、BO，分为13个字段，如下所示：



56位微码分放在7片存储器芯片中。

18位微码用于控制与给出每条微指令的下地址，供控制器部亻牛本身使用。其中：B55、B46的10位微码是下地址字段；B45、B44位备用；

B43、B40为C13、C℃是用于给出AM2910芯片的16种命令码的编号

B39、B37、B36分别为3位的SCC和1位的SC，给出AM2910芯片的条件判断信号℃C的选择码，用于保、微指令的条件转移等提供给运篡器部件的控制信号有26位@分别是：

A囗地址、B囗地址、A囗和B囗地址选择控制信号SA、SB，合计共10位；3组3位的AM2910的控制信号MI8-MI6、MI5—M13、MI2-I0共9位

控制标志寄存器写入的SST、最低位进位控制SCi、移位信号形成的SSH3个字段共7位。它们的使用已在运算器部件的讨论中讲述清楚。

还有3位微码／MIO、REQ和/WE用于控制内存的渎写、外设接囗的读写、以及微码的装入。

D11=D0：外部直接输入的数据，既可作为寄存器／计数器的初值，也可直接经地址多路选择器从Y输出，
作为下一条微指令的地址。

I3-I0：AM2910的命令码，来自微指令字的有关字段，用以选择AM2910的16条命令之一

/CC：条件输入，若为低电平，则表示测试成功，否则，表示测试失效。

/CCEN：/CC允许信号，若为低电平，则表示/CC有效否则，不管/CC是什么状态，测试条件为永真。

/RLD：寄存器/计数器装入信号，当为低电平时·不管AM2910所执行的命令和试条亻牛如何，都强制吧
直接输入DI1-DO装入。

/OE：Y输出允许信号，低电平有效，当为高电平时，Y输出为高阻态。CP：时钟脉冲信号，击低变高的
上升边沿触发所有内部状态的变化。输出线：

Y11-YO：下一条微指令的地址，它直接作为控制存储器的地址。/FULL：微堆栈满信号，低电平有效。

/PL、/MAP、NECT：3个使能信号，用于决定直接输入D的来源。AM2910的功能与具体用法
